<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="light">
    <title>è…å¥½åº· - æ¸¬é©—é€²è¡Œä¸­</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/additional-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* å¢å¤§å­—é«”å’Œé–“è· */
        .quiz-container {
            padding: 20px;
        }
        
        /* å¢å¤§å•é¡Œå¡ç‰‡ */
        .question-card {
            background-color: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* å¢å¤§å•é¡Œæ¨™é¡Œ */
        .question-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        /* å¢å¤§é¸é … */
        .option-item {
            background-color: var(--ios-gray6);
            border-radius: 16px;
            padding: 20px 18px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            border: 2px solid transparent; /* å¢åŠ é‚Šæ¡†æé«˜å¯è¦‹æ€§ */
        }
        
        /* åŠ å¼·é¸é …é¸ä¸­æ•ˆæœ */
        .option-item.selected {
            background-color: rgba(0, 122, 255, 0.2);
            border: 2px solid var(--ios-primary);
        }
        
        /* åŠ å¼·æ­£ç¢ºç­”æ¡ˆæ•ˆæœ */
        .option-item.correct {
            background-color: rgba(52, 199, 89, 0.15);
            border: 2px solid var(--ios-success);
        }
        
        /* åŠ å¼·éŒ¯èª¤ç­”æ¡ˆæ•ˆæœ */
        .option-item.incorrect {
            background-color: rgba(255, 59, 48, 0.15);
            border: 2px solid var(--ios-danger);
        }
        
        /* å¢å¤§é¸é …æ¨™ç±¤ */
        .option-label {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            margin-right: 16px;
            font-weight: 600;
            font-size: 18px;
            color: var(--ios-text-secondary);
            background-color: rgba(0, 0, 0, 0.08);
            border-radius: 50%;
        }
        
        /* å¢å¤§é¸é …æ–‡å­— */
        .option-text {
            font-size: 20px;
            line-height: 1.5;
            color: var(--ios-text-primary);
            flex: 1;
        }
        
        /* æ›´æ˜é¡¯çš„æ­£ç¢ºå’ŒéŒ¯èª¤åœ–æ¨™ */
        .option-icon {
            margin-left: auto;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 20px;
        }
        
        .option-icon.correct-icon {
            color: white;
            background-color: var(--ios-success);
        }
        
        .option-icon.incorrect-icon {
            color: white;
            background-color: var(--ios-danger);
            font-weight: bold;
        }
        
        /* å¢å¤§è§£é‡‹æ¡† */
        .explanation-box {
            background-color: rgba(52, 199, 89, 0.08);
            border-left: 6px solid var(--ios-success);
            padding: 20px;
            margin: 24px 0;
            border-radius: 16px;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            animation: slideUp 0.4s ease-out forwards;
        }
        
        .explanation-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--ios-success);
            display: flex;
            align-items: center;
        }
        
        .explanation-title i {
            margin-right: 10px;
            font-size: 22px;
        }
        
        #explanation-text {
            color: var(--ios-text-primary);
            font-size: 18px;
            line-height: 1.6;
        }
        
        /* å¢å¤§æŒ‰éˆ• */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 28px;
            padding: 0 2px;
        }
        
        .action-btn {
            flex: 1;
            padding: 18px 20px;
            border: none;
            border-radius: 16px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin: 0 8px;
        }
        
        .action-btn i {
            margin-right: 10px;
            font-size: 22px;
        }
        
        /* è¼”åŠ©æ–‡å­—æç¤º */
        .help-tip {
            text-align: center;
            font-size: 16px;
            color: var(--ios-text-tertiary);
            margin: 16px 0;
            font-style: italic;
        }
        
        /* å¢å¤§æç¤ºæŒ‰éˆ• */
        .hint-btn {
            background-color: #FFB74D;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            margin-top: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(255, 183, 77, 0.3);
        }
        
        .hint-btn i {
            margin-right: 8px;
            font-size: 20px;
        }
        
        /* è¦–åŠ›è¼”åŠ©å·¥å…· */
        .visual-aid-tools {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 16px;
        }
        
        .visual-aid-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 22px;
            background-color: var(--ios-gray6);
            color: var(--ios-text-primary);
            margin-left: 10px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="iphone-container">
        <!-- ç‹€æ…‹æ¬„ -->
        <div class="status-bar">
            <div class="status-time">9:41</div>
            <div class="status-icons">
                <div class="status-icon">ğŸ“¶</div>
                <div class="status-icon">ğŸ“Š</div>
                <div class="status-icon">ğŸ”‹</div>
            </div>
        </div>
        
        <!-- å°èˆªæ¬„ -->
        <div class="nav-bar">
            <div class="nav-back" id="quit-quiz">è¿”å›</div>
            <div class="nav-title">è…è‡ŸçŸ¥è­˜æ¸¬é©—</div>
            <div></div>
        </div>
        
        <!-- æ»¾å‹•å…§å®¹å€ -->
        <div class="content-container">
            <!-- æ¸¬é©—ç•«é¢ -->
            <div id="quiz-screen" class="quiz-container">
                <!-- è¦–åŠ›è¼”åŠ©å·¥å…· -->
                <div class="visual-aid-tools">
                    <div class="visual-aid-btn" id="increase-text">
                        <i class="fas fa-text-height"></i>
                    </div>
                    <div class="visual-aid-btn" id="high-contrast">
                        <i class="fas fa-adjust"></i>
                    </div>
                </div>
                
                <div class="timer-container">
                    <div class="timer">
                        <i class="fas fa-clock"></i> <span id="timer">02:00</span>
                    </div>
                </div>
                
                <div class="question-card">
                    <div class="question-title">
                        <span class="question-number">1</span> <span id="question-text">æ´—è…æ‚£è€…æ¯æ—¥å»ºè­°çš„æœ€å¤§é£²æ°´é‡æ˜¯å¤šå°‘ï¼Ÿ</span>
                    </div>
                    
                    <div class="options-list" id="options-list">
                        <!-- é¸é …å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                    
                    <button class="hint-btn" id="hint-btn" onclick="useHint()">
                        <i class="fas fa-lightbulb"></i> ä½¿ç”¨æç¤º
                    </button>
                    
                    <div class="help-tip">* é»æ“Šé¸é …é€²è¡Œé¸æ“‡ï¼Œç„¶å¾Œé»æ“Šã€Œä¸‹ä¸€é¡Œã€æŒ‰éˆ•ç¹¼çºŒ</div>
                    
                    <div id="explanation-box" class="explanation-box">
                        <div class="explanation-title">
                            <i class="fas fa-info-circle"></i> è§£æ
                        </div>
                        <div id="explanation-text"></div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn prev-btn" id="prev-btn" onclick="prevQuestion()">
                            <i class="fas fa-arrow-left"></i> ä¸Šä¸€é¡Œ
                        </button>
                        <button class="action-btn next-btn" id="next-btn" onclick="nextQuestion()">
                            ä¸‹ä¸€é¡Œ <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="question-status-container">
                    <div class="question-status-indicators" id="question-status">
                        <!-- å•é¡Œç‹€æ…‹æŒ‡ç¤ºå™¨å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- çµæœç•«é¢ -->
            <div id="result-screen" class="result-screen">
                <div class="result-header">
                    <div class="result-icon">ğŸ†</div>
                    <div class="result-title">æ¸¬é©—å®Œæˆ!</div>
                    <div class="result-subtitle">ä»¥ä¸‹æ˜¯æ‚¨çš„æ¸¬é©—çµæœ</div>
                </div>
                
                <div class="result-score" id="final-score">0</div>
                
                <div class="score-detail">
                    ç­”å°é¡Œæ•¸ï¼š<span id="correct-count">0</span> / <span id="total-questions">10</span>
                </div>
                
                <div class="result-message" id="result-message">
                    æ­£åœ¨è¨ˆç®—çµæœ...
                </div>
                
                <div class="action-buttons mt-3">
                    <div class="action-btn secondary" id="retry-btn">é‡æ–°æŒ‘æˆ°</div>
                    <div class="action-btn" id="back-to-selector">é¸æ“‡å…¶ä»–æ¸¬é©—</div>
                </div>
                
                <!-- éŒ¯é¡Œé›† -->
                <div id="incorrect-questions-container" class="incorrect-questions-container" style="display: none;">
                    <div class="incorrect-questions-title">éœ€è¦åŠ å¼·çš„é¡Œç›®</div>
                    <div id="incorrect-questions-list">
                        <!-- éŒ¯é¡Œå°‡ç”± JavaScript å‹•æ…‹æ·»åŠ  -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨æ¨™ç±¤æ¬„ -->
        <div class="tab-bar">
            <a href="main.html" class="tab-item">
                <i class="fas fa-home"></i>
                <span>é¦–é </span>
            </a>
            <a href="quiz-selector.html" class="tab-item active">
                <i class="fas fa-clipboard-list"></i>
                <span>æ¸¬é©—</span>
            </a>
            <a href="learning-resources.html" class="tab-item">
                <i class="fas fa-book-open"></i>
                <span>å­¸ç¿’</span>
            </a>
            <a href="dialysis-schedule.html" class="tab-item">
                <i class="fas fa-calendar-alt"></i>
                <span>æ’ç¨‹</span>
            </a>
        </div>
    </div>
    
    <!-- çå‹µå½ˆçª— -->
    <div id="reward-modal" class="reward-modal">
        <div class="reward-content">
            <div class="reward-icon">
                <i class="fas fa-gift"></i>
            </div>
            <div class="reward-title">æ­å–œç²å¾—çå‹µï¼</div>
            <div class="reward-description">
                ä½ ç²å¾—äº† <span id="reward-amount">20</span> é‡‘å¹£
            </div>
            <button id="reward-confirm" class="reward-confirm">ç¢ºèª</button>
        </div>
    </div>
    
    <script src="js/nursing-questions.js"></script>
    <script src="js/public-questions.js"></script>
    <script src="js/fontawesome.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è®Šæ•¸åˆå§‹åŒ–
            let currentQuestions = [];    // ç•¶å‰æ¸¬é©—çš„å•é¡Œ
            let currentQuestionIndex = 0; // ç•¶å‰å•é¡Œç´¢å¼•
            let score = 0;                // åˆ†æ•¸
            let timeLeft = 60;            // æ¯é¡Œå‰©é¤˜æ™‚é–“ï¼ˆç§’ï¼‰
            let timerInterval;            // è¨ˆæ™‚å™¨
            let selectedOptions = [];     // ç”¨æˆ¶é¸æ“‡çš„ç­”æ¡ˆ
            let quizType = localStorage.getItem('quizType') || 'public'; // å¾æœ¬åœ°å­˜å„²ç²å–æ¸¬é©—é¡å‹
            let incorrectQuestions = [];  // éŒ¯èª¤çš„å•é¡Œ
            let answeredQuestions = [];   // å·²å›ç­”çš„å•é¡Œ
            let isAnswerLocked = false;   // æ˜¯å¦é–å®šç•¶å‰é¡Œç›®çš„ç­”æ¡ˆé¸æ“‡
            
            // DOM å…ƒç´ 
            const quizScreen = document.getElementById('quiz-screen');
            const resultScreen = document.getElementById('result-screen');
            const timerElement = document.getElementById('timer');
            const progressBar = document.getElementById('progress-bar');
            const questionNumberElement = document.getElementById('question-number');
            const questionTextElement = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const explanationBox = document.getElementById('explanation-box');
            const explanationText = document.getElementById('explanation-text');
            const currentScoreElement = document.getElementById('current-score');
            const finalScoreElement = document.getElementById('final-score');
            const correctCountElement = document.getElementById('correct-count');
            const totalQuestionsElement = document.getElementById('total-questions');
            const resultMessageElement = document.getElementById('result-message');
            const incorrectQuestionsContainer = document.getElementById('incorrect-questions-container');
            const incorrectQuestionsList = document.getElementById('incorrect-questions-list');
            const questionStatusIndicators = document.getElementById('question-status-indicators');
            
            // æŒ‰éˆ•
            const prevButton = document.getElementById('prev-btn');
            const nextButton = document.getElementById('next-btn');
            const retryButton = document.getElementById('retry-btn');
            const backToSelectorButton = document.getElementById('back-to-selector');
            const quitButton = document.getElementById('quit-quiz');
            
            // åˆå§‹åŒ–æ¸¬é©—
            initializeQuiz();
            
            // åˆå§‹åŒ–æ¸¬é©—å‡½æ•¸
            function initializeQuiz() {
                // åˆå§‹åŒ–å•é¡Œ
                initializeQuizQuestions();
                
                // é‡ç½®æ¸¬é©—ç‹€æ…‹
                currentQuestionIndex = 0;
                score = 0;
                timeLeft = 60;
                selectedOptions = new Array(currentQuestions.length).fill(null);
                incorrectQuestions = [];
                answeredQuestions = [];
                isAnswerLocked = false;
                
                // æ›´æ–°ç•Œé¢
                updateQuestionDisplay();
                currentScoreElement.textContent = '0';
                
                // è¨­ç½®ç¸½é¡Œæ•¸
                totalQuestionsElement.textContent = currentQuestions.length;
                
                // åˆå§‹åŒ–é¡Œç›®ç‹€æ…‹æŒ‡ç¤ºå™¨
                updateQuestionStatus();
                
                // é¡¯ç¤ºæ¸¬é©—ç•«é¢
                quizScreen.style.display = 'block';
                resultScreen.style.display = 'none';
                
                // é–‹å§‹è¨ˆæ™‚
                startTimer();
                
                // ç¦ç”¨ä¸Šä¸€é¡ŒæŒ‰éˆ•ï¼ˆç¬¬ä¸€é¡Œï¼‰
                prevButton.style.opacity = '0.5';
                prevButton.style.pointerEvents = 'none';
                
                // è¨­ç½®ä¸‹ä¸€é¡ŒæŒ‰éˆ•æ–‡å­—
                nextButton.textContent = 'ä¸‹ä¸€é¡Œ';
            }
            
            // åˆå§‹åŒ–æ¸¬é©—å•é¡Œ
            function initializeQuizQuestions() {
                // æ ¹æ“šé¸æ“‡çš„æ¸¬é©—é¡å‹åŠ è¼‰å•é¡Œ
                switch(quizType) {
                    case 'public':
                        currentQuestions = publicQuestions.slice();
                        break;
                    case 'hd':
                        currentQuestions = nursingQuestions.hdQuestions.slice();
                        break;
                    case 'pd':
                        currentQuestions = nursingQuestions.pdQuestions.slice();
                        break;
                    default:
                        currentQuestions = publicQuestions.slice();
                }
                
                // éš¨æ©Ÿæ’åºå•é¡Œ
                currentQuestions = shuffleArray(currentQuestions).slice(0, 10);
            }
            
            // æ›´æ–°å•é¡Œé¡¯ç¤º
            function updateQuestionDisplay() {
                const question = currentQuestions[currentQuestionIndex];
                
                // æ›´æ–°å•é¡Œä¿¡æ¯
                questionNumberElement.textContent = `å•é¡Œ ${currentQuestionIndex + 1} / ${currentQuestions.length}`;
                questionTextElement.textContent = question.question;
                
                // æ›´æ–°é€²åº¦æ¢
                const progressPercentage = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                
                // æ¸…ç©ºé¸é …å®¹å™¨
                optionsContainer.innerHTML = '';
                
                // æ·»åŠ é¸é …
                question.options.forEach((option, index) => {
                    const optionCard = document.createElement('div');
                    optionCard.className = 'option-item';
                    optionCard.dataset.index = index;
                    
                    // å¦‚æœå·²ç¶“é¸æ“‡äº†è©²é¸é …
                    if(selectedOptions[currentQuestionIndex] === index) {
                        optionCard.classList.add('selected');
                    }
                    
                    optionCard.innerHTML = `
                        <div class="option-label">${String.fromCharCode(65 + index)}</div>
                        <div class="option-text">${option}</div>
                        <div class="option-icon"></div>
                    `;
                    
                    // æ·»åŠ é»æ“Šäº‹ä»¶
                    optionCard.addEventListener('click', function() {
                        selectOption(index);
                    });
                    
                    optionsContainer.appendChild(optionCard);
                });
                
                // éš±è—è§£é‡‹æ¡†
                explanationBox.style.display = 'none';
                
                // æª¢æŸ¥ç•¶å‰é¡Œç›®æ˜¯å¦å·²å›ç­”
                if (answeredQuestions.includes(currentQuestionIndex)) {
                    isAnswerLocked = true;
                    if (selectedOptions[currentQuestionIndex] !== null) {
                        selectOption(selectedOptions[currentQuestionIndex]);
                    }
                } else {
                    isAnswerLocked = false;
                    // é‡ç½®è¨ˆæ™‚å™¨
                    timeLeft = 60;
                    startTimer();
                }
                
                // æ·»åŠ é¡Œç›®ç‹€æ…‹é¡¯ç¤º
                updateQuestionStatus();
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                updateButtonsState();
            }
            
            // é¸æ“‡é¸é …
            function selectOption(optionIndex) {
                // å¦‚æœç­”æ¡ˆå·²é–å®šï¼Œä¸å…è¨±å†é¸æ“‡
                if (isAnswerLocked) {
                    return;
                }
                
                // è¨­ç½®é¸æ“‡çš„é¸é …ä¸¦é–å®šç­”æ¡ˆ
                selectedOptions[currentQuestionIndex] = optionIndex;
                isAnswerLocked = true;
                
                // å°‡ç•¶å‰é¡Œç›®æ¨™è¨˜ç‚ºå·²å›ç­”
                if (!answeredQuestions.includes(currentQuestionIndex)) {
                    answeredQuestions.push(currentQuestionIndex);
                }
                
                // æ¸…é™¤ç•¶å‰é¡Œç›®è¨ˆæ™‚å™¨
                clearInterval(timerInterval);
                
                // æ›´æ–°é¸é …é¡¯ç¤º
                const optionCards = document.querySelectorAll('.option-item');
                optionCards.forEach(card => {
                    card.classList.remove('selected', 'correct', 'incorrect');
                });
                
                // æ¨™è¨˜é¸ä¸­çš„é¸é …
                const currentQuestion = currentQuestions[currentQuestionIndex];
                const selectedCard = optionCards[optionIndex];
                selectedCard.classList.add('selected');
                
                // é¡¯ç¤ºæ˜¯å¦æ­£ç¢º
                if(optionIndex === currentQuestion.correctAnswer) {
                    selectedCard.classList.add('correct');
                    selectedCard.querySelector('.option-icon').className = 'option-icon correct-icon';
                    selectedCard.querySelector('.option-icon').innerHTML = 'âœ“';
                    
                    // æ›´æ–°åˆ†æ•¸ï¼Œåªæœ‰åœ¨ç­”å°æ™‚åŠ åˆ†
                    score += 10;
                    currentScoreElement.textContent = score;
                } else {
                    selectedCard.classList.add('incorrect');
                    selectedCard.querySelector('.option-icon').className = 'option-icon incorrect-icon';
                    selectedCard.querySelector('.option-icon').innerHTML = 'âœ—';
                    
                    // æ¨™è¨˜æ­£ç¢ºç­”æ¡ˆ
                    const correctCard = optionCards[currentQuestion.correctAnswer];
                    correctCard.classList.add('correct');
                    correctCard.querySelector('.option-icon').className = 'option-icon correct-icon';
                    correctCard.querySelector('.option-icon').innerHTML = 'âœ“';
                    
                    // è¨˜éŒ„éŒ¯é¡Œ
                    if(!incorrectQuestions.includes(currentQuestionIndex)) {
                        incorrectQuestions.push(currentQuestionIndex);
                    }
                }
                
                // é¡¯ç¤ºè§£é‡‹
                if(currentQuestion.explanation) {
                    explanationBox.style.display = 'block';
                    explanationText.textContent = currentQuestion.explanation;
                }
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                updateButtonsState();
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            function updateButtonsState() {
                // ä¸Šä¸€é¡ŒæŒ‰éˆ•
                if(currentQuestionIndex === 0) {
                    prevButton.style.opacity = '0.5';
                    prevButton.style.pointerEvents = 'none';
                } else {
                    prevButton.style.opacity = '1';
                    prevButton.style.pointerEvents = 'auto';
                }
                
                // ä¸‹ä¸€é¡Œ/æäº¤æŒ‰éˆ•
                if(currentQuestionIndex === currentQuestions.length - 1) {
                    nextButton.textContent = 'æäº¤ç­”æ¡ˆ';
                } else {
                    nextButton.textContent = 'ä¸‹ä¸€é¡Œ';
                }
                
                // å¦‚æœç•¶å‰é¡Œç›®å·²ç¶“é¸æ“‡äº†ç­”æ¡ˆ
                if(selectedOptions[currentQuestionIndex] !== null) {
                    nextButton.style.opacity = '1';
                    nextButton.style.pointerEvents = 'auto';
                } else {
                    // å¯ä»¥åœ¨é€™è£¡æ±ºå®šæ˜¯å¦ç¦ç”¨ä¸‹ä¸€é¡ŒæŒ‰éˆ•
                    // æ­¤è™•å…è¨±è·³éå•é¡Œ
                    nextButton.style.opacity = '1';
                    nextButton.style.pointerEvents = 'auto';
                }
            }
            
            // ç§»å‹•åˆ°ä¸Šä¸€é¡Œ
            function goToPreviousQuestion() {
                if(currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    updateQuestionDisplay();
                    
                    // å¦‚æœå·²ç¶“é¸æ“‡äº†ç­”æ¡ˆï¼Œé¡¯ç¤ºçµæœ
                    if(selectedOptions[currentQuestionIndex] !== null) {
                        selectOption(selectedOptions[currentQuestionIndex]);
                    }
                    
                    // æ›´æ–°é¡Œç›®ç‹€æ…‹æŒ‡ç¤ºå™¨
                    updateQuestionStatus();
                }
            }
            
            // ç§»å‹•åˆ°ä¸‹ä¸€é¡Œæˆ–æäº¤
            function goToNextOrSubmit() {
                if(currentQuestionIndex < currentQuestions.length - 1) {
                    // ç§»å‹•åˆ°ä¸‹ä¸€é¡Œ
                    currentQuestionIndex++;
                    updateQuestionDisplay();
                    
                    // å¦‚æœå·²ç¶“é¸æ“‡äº†ç­”æ¡ˆï¼Œé¡¯ç¤ºçµæœ
                    if(selectedOptions[currentQuestionIndex] !== null) {
                        selectOption(selectedOptions[currentQuestionIndex]);
                    }
                    
                    // æ›´æ–°é¡Œç›®ç‹€æ…‹æŒ‡ç¤ºå™¨
                    updateQuestionStatus();
                } else {
                    // æäº¤ç­”æ¡ˆ
                    finishQuiz();
                }
            }
            
            // å®Œæˆæ¸¬é©—
            function finishQuiz() {
                // åœæ­¢è¨ˆæ™‚å™¨
                clearInterval(timerInterval);
                
                // è¨ˆç®—åˆ†æ•¸ - åªè¨ˆç®—å·²å›ç­”æ­£ç¢ºçš„é¡Œç›®
                let correctCount = 0;
                
                for(let i = 0; i < currentQuestions.length; i++) {
                    if(selectedOptions[i] === currentQuestions[i].correctAnswer) {
                        correctCount++;
                    }
                }
                
                // æœ€çµ‚åˆ†æ•¸ç‚ºæ­£ç¢ºé¡Œç›®æ•¸ * 10
                score = correctCount * 10;
                
                // æ›´æ–°ç•Œé¢
                finalScoreElement.textContent = score;
                correctCountElement.textContent = correctCount;
                
                // è¨­ç½®çµæœæ¶ˆæ¯
                let resultMessage;
                if(score >= 90) {
                    resultMessage = "å¤ªæ£’äº†ï¼æ‚¨æ˜¯è…è‡ŸçŸ¥è­˜çš„å°ˆå®¶ï¼";
                } else if(score >= 70) {
                    resultMessage = "åšå¾—å¥½ï¼æ‚¨å°è…è‡ŸçŸ¥è­˜æœ‰å¾ˆå¥½çš„ç†è§£ã€‚";
                } else if(score >= 50) {
                    resultMessage = "åŠæ ¼ï¼æ‚¨å°è…è‡ŸçŸ¥è­˜æœ‰åŸºæœ¬äº†è§£ã€‚";
                } else {
                    resultMessage = "éœ€è¦åŠ å¼·ï¼å»ºè­°æ‚¨é‡æ–°å­¸ç¿’ç›¸é—œçŸ¥è­˜ã€‚";
                }
                resultMessageElement.textContent = resultMessage;
                
                // å¦‚æœæœ‰éŒ¯é¡Œï¼Œé¡¯ç¤ºéŒ¯é¡Œé›†
                if(incorrectQuestions.length > 0) {
                    displayIncorrectQuestions();
                    incorrectQuestionsContainer.style.display = 'block';
                } else {
                    incorrectQuestionsContainer.style.display = 'none';
                }
                
                // é¡¯ç¤ºçµæœç•«é¢
                quizScreen.style.display = 'none';
                resultScreen.style.display = 'block';
            }
            
            // é¡¯ç¤ºéŒ¯é¡Œé›†
            function displayIncorrectQuestions() {
                incorrectQuestionsList.innerHTML = '';
                
                incorrectQuestions.forEach(index => {
                    const question = currentQuestions[index];
                    const selectedOption = selectedOptions[index];
                    
                    const incorrectCard = document.createElement('div');
                    incorrectCard.className = 'incorrect-question-card';
                    
                    let selectedAnswer = 'æœªä½œç­”';
                    if (selectedOption !== null && selectedOption >= 0) {
                        selectedAnswer = question.options[selectedOption];
                    }
                    
                    incorrectCard.innerHTML = `
                        <div class="incorrect-question-text">${question.question}</div>
                        <div class="incorrect-answers">
                            <div class="incorrect-answer">æ‚¨çš„ç­”æ¡ˆï¼š${selectedAnswer}</div>
                            <div class="correct-answer">æ­£ç¢ºç­”æ¡ˆï¼š${question.options[question.correctAnswer]}</div>
                        </div>
                        <div class="question-explanation">${question.explanation || 'ç„¡è§£é‡‹'}</div>
                    `;
                    
                    incorrectQuestionsList.appendChild(incorrectCard);
                });
            }
            
            // é–‹å§‹è¨ˆæ™‚å™¨
            function startTimer() {
                clearInterval(timerInterval);
                
                const updateTimer = () => {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    
                    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if(timeLeft <= 0) {
                        clearInterval(timerInterval);
                        
                        // æ™‚é–“åˆ°ï¼Œè‡ªå‹•æäº¤ç•¶å‰é¡Œç›®çš„ç­”æ¡ˆ
                        // å¦‚æœç”¨æˆ¶æ²’æœ‰é¸æ“‡ï¼Œå‰‡è¦–ç‚ºéŒ¯èª¤
                        if (!answeredQuestions.includes(currentQuestionIndex)) {
                            selectedOptions[currentQuestionIndex] = -1; // æ¨™è¨˜ç‚ºæœªé¸æ“‡
                            incorrectQuestions.push(currentQuestionIndex);
                            answeredQuestions.push(currentQuestionIndex);
                            isAnswerLocked = true;
                            
                            // æ¨™è¨˜æ‰€æœ‰é¸é …ï¼Œé¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
                            const optionCards = document.querySelectorAll('.option-item');
                            const correctIndex = currentQuestions[currentQuestionIndex].correctAnswer;
                            
                            // æ¨™è¨˜æ­£ç¢ºç­”æ¡ˆ
                            optionCards[correctIndex].classList.add('correct');
                            optionCards[correctIndex].querySelector('.option-icon').className = 'option-icon correct-icon';
                            optionCards[correctIndex].querySelector('.option-icon').innerHTML = 'âœ“';
                            
                            // é¡¯ç¤ºè§£é‡‹
                            if (currentQuestions[currentQuestionIndex].explanation) {
                                explanationBox.style.display = 'block';
                                explanationText.textContent = currentQuestions[currentQuestionIndex].explanation;
                            }
                            
                            // æ›´æ–°é¡Œç›®ç‹€æ…‹æŒ‡ç¤ºå™¨
                            updateQuestionStatus();
                            
                            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                            updateButtonsState();
                        }
                    }
                    
                    timeLeft--;
                };
                
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);
            }
            
            // æ´—ç‰Œæ•¸çµ„å‡½æ•¸
            function shuffleArray(array) {
                const newArray = [...array];
                for(let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            
            // äº‹ä»¶ç›£è½å™¨
            prevButton.addEventListener('click', goToPreviousQuestion);
            nextButton.addEventListener('click', goToNextOrSubmit);
            retryButton.addEventListener('click', function() {
                initializeQuiz();
            });
            backToSelectorButton.addEventListener('click', function() {
                window.location.href = 'quiz-selector.html';
            });
            quitButton.addEventListener('click', function() {
                if(confirm('ç¢ºå®šè¦é€€å‡ºæ¸¬é©—å—ï¼Ÿæ‚¨çš„é€²åº¦å°‡ä¸æœƒè¢«ä¿å­˜ã€‚')) {
                    window.location.href = 'quiz-selector.html';
                }
            });
            
            // æ·»åŠ  updateQuestionStatus å‡½æ•¸
            function updateQuestionStatus() {
                // æ¸…ç©ºç‹€æ…‹æŒ‡ç¤ºå™¨
                questionStatusIndicators.innerHTML = '';
                
                // ç‚ºæ¯å€‹å•é¡Œæ·»åŠ ç‹€æ…‹æŒ‡ç¤ºå™¨
                for (let i = 0; i < currentQuestions.length; i++) {
                    const indicator = document.createElement('div');
                    indicator.className = 'status-indicator';
                    indicator.textContent = (i + 1).toString();
                    
                    // è¨­ç½®ç‹€æ…‹æ¨£å¼
                    if (i === currentQuestionIndex) {
                        indicator.classList.add('current');
                    }
                    
                    if (answeredQuestions.includes(i)) {
                        indicator.classList.add('answered');
                        
                        if (selectedOptions[i] === currentQuestions[i].correctAnswer) {
                            indicator.classList.add('correct');
                        } else {
                            indicator.classList.add('incorrect');
                        }
                    }
                    
                    // æ·»åŠ é»æ“Šäº‹ä»¶ï¼Œå…è¨±ç›´æ¥è·³è½‰åˆ°è©²é¡Œ
                    indicator.addEventListener('click', function() {
                        goToQuestion(i);
                    });
                    
                    questionStatusIndicators.appendChild(indicator);
                }
            }
            
            // æ·»åŠ è·³è½‰åˆ°æŒ‡å®šé¡Œç›®çš„å‡½æ•¸
            function goToQuestion(index) {
                if (index !== currentQuestionIndex) {
                    currentQuestionIndex = index;
                    updateQuestionDisplay();
                }
            }

            // å¢åŠ æ–‡å­—å¤§å°åŠŸèƒ½
            document.getElementById('increase-text').addEventListener('click', function() {
                document.body.classList.toggle('large-text');
                
                // å¦‚æœæœ‰large-texté¡ï¼Œå‰‡æ”¾å¤§æ‰€æœ‰æ–‡å­—
                if (document.body.classList.contains('large-text')) {
                    document.documentElement.style.setProperty('--font-size-multiplier', '1.2');
                } else {
                    document.documentElement.style.setProperty('--font-size-multiplier', '1');
                }
            });

            // é«˜å°æ¯”åº¦æ¨¡å¼
            document.getElementById('high-contrast').addEventListener('click', function() {
                document.body.classList.toggle('high-contrast');
                
                if (document.body.classList.contains('high-contrast')) {
                    document.documentElement.style.setProperty('--ios-text-primary', '#000000');
                    document.documentElement.style.setProperty('--ios-text-secondary', '#222222');
                    document.documentElement.style.setProperty('--ios-primary', '#0056b3');
                    document.documentElement.style.setProperty('--ios-background', '#ffffff');
                } else {
                    document.documentElement.style.setProperty('--ios-text-primary', '');
                    document.documentElement.style.setProperty('--ios-text-secondary', '');
                    document.documentElement.style.setProperty('--ios-primary', '');
                    document.documentElement.style.setProperty('--ios-background', '');
                }
            });
        });
    </script>
</body>
</html> 